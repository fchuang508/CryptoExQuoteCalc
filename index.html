<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CryptoExQuoteCalc</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body class="p-4">
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    function App() {
      const translations = {
        en: {
          toggle: '中文',
          ethUsd: 'ETHUSD Price',
          usdCny: 'USD/CNY Rate',
          fee: 'Fee (CNY)',
          premium: 'Premium %',
          ethAmount: 'Amount (ETH)',
          cnyAmount: 'Amount (CNY)',
          marketPrice: 'Market Price (CNY/ETH)',
          priceWithPremium: 'Price With Premium',
          premiumDiff: 'Premium Difference',
          marketTotal: 'Total w/o Premium + Fee',
          premiumTotal: 'Total w/ Premium + Fee',
          copy: 'Copy',
          reset: 'Reset'
        },
        zh: {
          toggle: 'EN',
          ethUsd: 'ETHUSD 价格',
          usdCny: '美元兑人民币 (USD/CNY)',
          fee: '手续费 (CNY)',
          premium: '溢价 %',
          ethAmount: '加密金额 (ETH)',
          cnyAmount: '法币金额 (CNY)',
          marketPrice: '市场价 (元/ETH)',
          priceWithPremium: '溢价后价格',
          premiumDiff: '溢价差额',
          marketTotal: '总价（无溢价+手续费）',
          premiumTotal: '总价（含溢价+手续费）',
          copy: '复制',
          reset: '重置'
        }
      };

      const [lang, setLang] = useState('en');
      const t = translations[lang];

      const [ethUsd, setEthUsd] = useState(3000);
      const [usdCny, setUsdCny] = useState(7);
      const [fee, setFee] = useState(20);
      const [premium, setPremium] = useState(3.275);
      const [ethAmount, setEthAmount] = useState(1);
      const [cnyAmount, setCnyAmount] = useState('');

      const marketPrice = ethUsd * usdCny;
      const priceWithPremium = marketPrice * (1 + premium / 100);

      const convertEthToCny = (eth, ethUsdRate, usdCnyRate) => eth * ethUsdRate * usdCnyRate;

      const handleEthChange = (e) => {
        const value = e.target.value;
        setEthAmount(value === '' ? '' : Math.max(0, parseFloat(value)));
        setCnyAmount('');
      };

      const handleCnyChange = (e) => {
        const value = e.target.value;
        setCnyAmount(value === '' ? '' : Math.max(0, parseFloat(value)));
        setEthAmount('');
      };

      const ethTotal = cnyAmount !== '' ? (parseFloat(cnyAmount) || 0) / marketPrice : (parseFloat(ethAmount) || 0);
      const marketTotal = ethTotal * marketPrice;
      const marketTotalWithFee = marketTotal + fee;
      const premiumTotal = ethTotal * priceWithPremium;
      const premiumTotalWithFee = premiumTotal + fee;
      const premiumDiff = premiumTotal - marketTotal;

      const copyQuote = async () => {
        const text = `${ethTotal.toFixed(4)} ETH @ ${priceWithPremium.toFixed(5)} CNY (total ${premiumTotalWithFee.toFixed(2)} CNY)`;
        try {
          await navigator.clipboard.writeText(text);
          alert('Quote copied to clipboard');
        } catch (err) {
          alert('Failed to copy quote');
        }
      };

      const reset = () => {
        const defaultEthUsd = 3000;
        const defaultUsdCny = 7;
        const defaultFee = 20;
        const defaultPremium = 3.275;
        const defaultEthAmount = 0;
        const defaultCnyAmount = convertEthToCny(defaultEthAmount, defaultEthUsd, defaultUsdCny);

        setEthUsd(defaultEthUsd);
        setUsdCny(defaultUsdCny);
        setFee(defaultFee);
        setPremium(defaultPremium);
        setEthAmount(defaultEthAmount);
        setCnyAmount(defaultCnyAmount);
      };

      return (
        <div className="max-w-xl mx-auto space-y-4">
          <div className="flex justify-between items-center">
            <h1 className="text-2xl font-bold">CryptoExQuoteCalc</h1>
            <button className="border px-2 py-1" onClick={() => setLang(lang === 'en' ? 'zh' : 'en')}>{t.toggle}</button>
          </div>

          <div className="flex flex-wrap gap-4">
            <label className="flex flex-col flex-1 min-w-[140px]">{t.ethUsd}
              <input type="number" min="0" className="border p-1" value={ethUsd} onChange={e => setEthUsd(Math.max(0, parseFloat(e.target.value) || 0))} onFocus={e => e.target.select()} />
              <span className="text-xs text-gray-500">{lang === 'en' ? 'DEX/CEX market' : '与DEX/CEX行情一致'}</span>
            </label>
            <label className="flex flex-col flex-1 min-w-[140px]">{t.usdCny}
              <input type="number" min="0" step="0.00001" className="border p-1" value={usdCny.toFixed(5)} onChange={e => setUsdCny(Math.max(0, parseFloat(e.target.value) || 0))} onFocus={e => e.target.select()} />
              <span className="text-xs text-gray-500">{lang === 'en' ? '1 USD equals CNY' : '1美元兑换多少人民币'}</span>
            </label>
            <label className="flex flex-col flex-1 min-w-[140px]">{t.fee}
              <input type="number" min="0" className="border p-1" value={fee} onChange={e => setFee(Math.max(0, parseFloat(e.target.value) || 0))} onFocus={e => e.target.select()} />
              <span className="text-xs text-gray-500">{lang === 'en' ? 'Handling fee in CNY' : '以人民币计的手续费'}</span>
            </label>
            <label className="flex flex-col flex-1 min-w-[140px]">{t.premium}
              <div className="flex border p-1 items-center">
                <input type="number" min="0" max="100" step="0.001" className="flex-1 outline-none" value={premium} onChange={e => setPremium(parseFloat(e.target.value) || 0)} onFocus={e => e.target.select()} />
                <span className="ml-1">%</span>
              </div>
              <span className="text-xs text-gray-500">{lang === 'en' ? '0-100%' : '范围0-100%'}</span>
            </label>
            <label className="flex flex-col flex-1 min-w-[140px]">{t.ethAmount}
              <input type="number" min="0" className="border p-1" value={ethAmount} onChange={handleEthChange} placeholder="1" onFocus={e => e.target.select()} />
            </label>
            <label className="flex flex-col flex-1 min-w-[140px]">{t.cnyAmount}
              <input type="number" min="0" className="border p-1" value={cnyAmount} onChange={handleCnyChange} placeholder="auto" onFocus={e => e.target.select()} />
            </label>
          </div>

          <div className="border p-4 space-y-2">
            <div>{t.marketPrice}: {marketPrice.toFixed(5)}</div>
            <div>{t.priceWithPremium}: {priceWithPremium.toFixed(5)}</div>
            <div>{t.premiumDiff}: {premiumDiff.toFixed(2)} CNY</div>
          </div>

          <div className="border p-4 space-y-2">
            <div>{t.marketTotal}: {marketTotalWithFee.toFixed(2)} CNY</div>
            <div>{t.premiumTotal}: {premiumTotalWithFee.toFixed(2)} CNY</div>
          </div>

          <div className="flex gap-2">
            <button className="px-2 py-1 bg-blue-500 text-white" onClick={copyQuote}>{t.copy}</button>
            <button className="px-2 py-1 bg-gray-300" onClick={reset}>{t.reset}</button>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
